#/bin/bash
# vi: ft=bash

# Read systemd service names from stdin, choose one using rofi and toggle its state.

set -u
set -e
set -o pipefail

service=$(cat | xargs -n1 -I{} sh -c 'echo `systemctl is-active {}` {}' | sort -k1 | rofi -dmenu)
IFS=' ' read state name <<<"$service"

export SUDO_ASKPASS="$HOME/.scripts/rofi-askpass"

[[ $state == 'active' ]] && sudo -A systemctl stop $name || sudo -A systemctl start $name

notify-send "$name is now $(systemctl is-active $name)"

